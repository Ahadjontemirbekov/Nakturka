<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
      /* Umumiy stillar */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
          background-color: #f5f7fb;
          color: #333;
          line-height: 1.6;
      }

      .admin-container {
          display: flex;
          min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
          width: 250px;
          background: linear-gradient(135deg, #2c3e50, #34495e);
          color: white;
          transition: all 0.3s ease;
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
          z-index: 1000;
      }

      .logo {
          display: flex;
          align-items: center;
          padding: 20px 15px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          margin-bottom: 20px;
      }

      .logo i {
          font-size: 24px;
          margin-right: 10px;
          color: #3498db;
      }

      .logo span {
          font-size: 20px;
          font-weight: 600;
      }

      .nav-links {
          list-style: none;
          padding: 0 15px;
      }

      .nav-links li {
          margin-bottom: 5px;
      }

      .nav-links a {
          display: flex;
          align-items: center;
          padding: 12px 15px;
          color: rgba(255, 255, 255, 0.8);
          text-decoration: none;
          border-radius: 8px;
          transition: all 0.3s ease;
      }

      .nav-links a:hover {
          background: rgba(255, 255, 255, 0.1);
          color: white;
      }

      .nav-links a.active {
          background: rgba(52, 152, 219, 0.2);
          color: white;
          border-left: 4px solid #3498db;
      }

      .nav-links i {
          margin-right: 10px;
          font-size: 18px;
          width: 20px;
          text-align: center;
      }

      /* Asosiy kontent */
      .main-content {
          flex: 1;
          display: flex;
          flex-direction: column;
          overflow: hidden;
      }

      /* Header */
      .header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 20px 30px;
          background: white;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .header h1 {
          font-size: 24px;
          color: #2c3e50;
          font-weight: 600;
      }

      .user-profile {
          display: flex;
          align-items: center;
          cursor: pointer;
      }

      .user-profile img {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          margin-right: 10px;
          object-fit: cover;
      }

      .user-profile span {
          font-weight: 500;
          margin-right: 10px;
      }

      /* Statistik kartalar */
      .stats-cards {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
          gap: 20px;
          padding: 20px 30px;
      }

      .card {
          display: flex;
          align-items: center;
          background: white;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
          transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .card-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 60px;
          height: 60px;
          border-radius: 10px;
          margin-right: 15px;
          font-size: 24px;
          color: white;
      }

      .bg-blue {
          background: linear-gradient(135deg, #3498db, #2980b9);
      }

      .bg-green {
          background: linear-gradient(135deg, #2ecc71, #27ae60);
      }

      .bg-orange {
          background: linear-gradient(135deg, #e67e22, #d35400);
      }

      .bg-red {
          background: linear-gradient(135deg, #e74c3c, #c0392b);
      }

      .card-info h3 {
          font-size: 24px;
          font-weight: 700;
          margin-bottom: 5px;
      }

      .card-info p {
          color: #7f8c8d;
          font-size: 14px;
      }

      /* Yuklash bo'limi */
      .upload-section {
          background: white;
          margin: 0 30px 30px;
          border-radius: 10px;
          padding: 25px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }

      .section-header {
          margin-bottom: 20px;
      }

      .section-header h2 {
          font-size: 22px;
          color: #2c3e50;
          margin-bottom: 5px;
      }

      .section-header p {
          color: #7f8c8d;
      }

      .upload-area {
          border: 2px dashed #bdc3c7;
          border-radius: 10px;
          padding: 40px 20px;
          text-align: center;
          cursor: pointer;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
      }

      .upload-area:hover {
          border-color: #3498db;
          background: rgba(52, 152, 219, 0.05);
      }

      .upload-area i {
          font-size: 48px;
          color: #bdc3c7;
          margin-bottom: 15px;
          transition: color 0.3s ease;
      }

      .upload-area:hover i {
          color: #3498db;
      }

      .upload-area p {
          color: #7f8c8d;
          font-size: 16px;
      }

      .upload-area p span {
          color: #3498db;
          font-weight: 500;
      }

      #fileInput {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          opacity: 0;
          cursor: pointer;
      }

      .upload-progress {
          margin-top: 20px;
          display: none;
      }

      .progress-bar {
          width: 100%;
          height: 10px;
          background: #ecf0f1;
          border-radius: 5px;
          overflow: hidden;
          margin-bottom: 10px;
      }

      .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #2ecc71, #27ae60);
          width: 0%;
          transition: width 0.3s ease;
      }

      .progress-text {
          font-size: 14px;
          color: #7f8c8d;
          text-align: center;
          display: block;
      }

      /* Media galereya */
      .media-gallery {
          background: white;
          margin: 0 30px 30px;
          border-radius: 10px;
          padding: 25px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
          flex: 1;
          overflow: auto;
      }

      .filter-options {
          display: flex;
          margin-top: 15px;
      }

      .filter-btn {
          padding: 8px 16px;
          background: #ecf0f1;
          border: none;
          border-radius: 5px;
          margin-right: 10px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-weight: 500;
      }

      .filter-btn.active {
          background: #3498db;
          color: white;
      }

      .filter-btn:hover:not(.active) {
          background: #d5dbdb;
      }

      .media-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 20px;
          margin-top: 20px;
      }

      .media-item {
          position: relative;
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
          cursor: pointer;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          aspect-ratio: 1;
      }

      .media-item:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .media-item img,
      .media-item video {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
      }

      .media-overlay {
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
          padding: 15px;
          color: white;
          transform: translateY(100%);
          transition: transform 0.3s ease;
      }

      .media-item:hover .media-overlay {
          transform: translateY(0);
      }

      .media-name {
          font-size: 14px;
          font-weight: 500;
          margin-bottom: 5px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      .media-size {
          font-size: 12px;
          opacity: 0.8;
      }

      .media-type {
          position: absolute;
          top: 10px;
          right: 10px;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
      }

      /* Modal */
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.8);
          z-index: 2000;
          align-items: center;
          justify-content: center;
          padding: 20px;
      }

      .modal-content {
          background: white;
          border-radius: 10px;
          width: 100%;
          max-width: 900px;
          max-height: 90vh;
          overflow: hidden;
          position: relative;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .close-btn {
          position: absolute;
          top: 15px;
          right: 20px;
          font-size: 28px;
          color: #7f8c8d;
          cursor: pointer;
          z-index: 10;
          transition: color 0.3s ease;
      }

      .close-btn:hover {
          color: #e74c3c;
      }

      .modal-body {
          display: flex;
          height: 100%;
      }

      .modal-body img,
      .modal-body video {
          flex: 1;
          max-width: 70%;
          object-fit: contain;
          background: #f8f9fa;
      }

      .media-info {
          flex: 0 0 30%;
          padding: 30px;
          background: white;
          display: flex;
          flex-direction: column;
          justify-content: center;
      }

      .media-info h3 {
          font-size: 20px;
          margin-bottom: 10px;
          color: #2c3e50;
      }

      .media-info p {
          margin-bottom: 8px;
          color: #7f8c8d;
          font-size: 14px;
      }

      .action-buttons {
          margin-top: 20px;
          display: flex;
          flex-direction: column;
          gap: 10px;
      }

      .btn {
          padding: 10px 15px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-weight: 500;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
      }

      .btn i {
          margin-right: 8px;
      }

      .btn-primary {
          background: #3498db;
          color: white;
      }

      .btn-primary:hover {
          background: #2980b9;
      }

      .btn-danger {
          background: #e74c3c;
          color: white;
      }

      .btn-danger:hover {
          background: #c0392b;
      }

      /* Responsivlik */
      @media (max-width: 992px) {
          .sidebar {
              width: 80px;
          }

          .logo span,
          .nav-links span {
              display: none;
          }

          .nav-links a {
              justify-content: center;
              padding: 15px;
          }

          .nav-links i {
              margin-right: 0;
              font-size: 20px;
          }

          .modal-body {
              flex-direction: column;
          }

          .modal-body img,
          .modal-body video {
              max-width: 100%;
              max-height: 60vh;
          }

          .media-info {
              flex: 0 0 auto;
          }
      }

      @media (max-width: 768px) {
          .admin-container {
              flex-direction: column;
          }

          .sidebar {
              width: 100%;
              height: auto;
          }

          .nav-links {
              display: flex;
              overflow-x: auto;
              padding: 10px 15px;
          }

          .nav-links li {
              margin-bottom: 0;
              margin-right: 10px;
              flex-shrink: 0;
          }

          .nav-links a {
              padding: 10px 15px;
          }

          .stats-cards {
              grid-template-columns: repeat(2, 1fr);
              padding: 15px;
          }

          .upload-section,
          .media-gallery {
              margin: 0 15px 15px;
          }

          .header {
              padding: 15px;
          }

          .header h1 {
              font-size: 20px;
          }
      }

      @media (max-width: 576px) {
          .stats-cards {
              grid-template-columns: 1fr;
          }

          .media-grid {
              grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          }

          .filter-options {
              flex-wrap: wrap;
          }

          .filter-btn {
              margin-bottom: 10px;
          }
      }

      /* Animatsiyalar */
      @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
      }

      @keyframes slideIn {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
      }

      .fade-in {
          animation: fadeIn 0.5s ease;
      }

      .slide-in {
          animation: slideIn 0.5s ease;
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
          width: 8px;
      }

      ::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
          background: #c1c1c1;
          border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
          background: #a8a8a8;
      }

      /* Qo'shimcha stillar */
      .empty-state {
          text-align: center;
          padding: 40px 20px;
          color: #7f8c8d;
      }

      .empty-state i {
          font-size: 64px;
          margin-bottom: 20px;
          color: #bdc3c7;
      }

      .empty-state h3 {
          font-size: 20px;
          margin-bottom: 10px;
      }

      .loading {
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 40px;
      }

      .loading-spinner {
          width: 40px;
          height: 40px;
          border: 4px solid rgba(52, 152, 219, 0.2);
          border-left: 4px solid #3498db;
          border-radius: 50%;
          animation: spin 1s linear infinite;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          background: #2ecc71;
          color: white;
          border-radius: 5px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
          z-index: 3000;
          transform: translateX(150%);
          transition: transform 0.3s ease;
      }

      .notification.show {
          transform: translateX(0);
      }

      .notification.error {
          background: #e74c3c;
      }

      /* Dark mode qo'shimchasi */
      body.dark-mode {
          background-color: #1a1a1a;
          color: #e0e0e0;
      }

      body.dark-mode .header,
      body.dark-mode .card,
      body.dark-mode .upload-section,
      body.dark-mode .media-gallery,
      body.dark-mode .modal-content,
      body.dark-mode .media-info {
          background: #2d2d2d;
          color: #e0e0e0;
      }

      body.dark-mode .header h1,
      body.dark-mode .section-header h2,
      body.dark-mode .media-info h3 {
          color: #e0e0e0;
      }

      body.dark-mode .card-info p,
      body.dark-mode .section-header p,
      body.dark-mode .upload-area p {
          color: #b0b0b0;
      }

      body.dark-mode .upload-area {
          border-color: #444;
      }

      body.dark-mode .upload-area:hover {
          border-color: #3498db;
          background: rgba(52, 152, 219, 0.1);
      }

      body.dark-mode .filter-btn {
          background: #444;
          color: #e0e0e0;
      }

      body.dark-mode .filter-btn.active {
          background: #3498db;
      }

      body.dark-mode .filter-btn:hover:not(.active) {
          background: #555;
      }

      body.dark-mode .modal-body img,
      body.dark-mode .modal-body video {
          background: #1a1a1a;
      }

      /* Qo'shimcha effektlar */
      .media-item::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0);
          transition: background 0.3s ease;
          z-index: 1;
      }

      .media-item:hover::before {
          background: rgba(0, 0, 0, 0.2);
      }

      .media-overlay {
          z-index: 2;
      }

      /* Print stillari */
      @media print {
          .sidebar, .header, .upload-section, .action-buttons {
              display: none;
          }

          .main-content {
              margin: 0;
          }

          .media-gallery {
              box-shadow: none;
              margin: 0;
          }
      }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-photo-video"></i>
                <span>Media Admin</span>
            </div>
            <ul class="nav-links">
                <li>
                    <a href="#" class="active">
                        <i class="fas fa-home"></i>
                        <span>Bosh Sahifa</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-images"></i>
                        <span>Rasmlar</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-video"></i>
                        <span>Videolar</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-upload"></i>
                        <span>Yuklash</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-cog"></i>
                        <span>Sozlamalar</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1>Media Boshqaruv Paneli</h1>
                </div>
                <div class="header-right">
                    <div class="user-profile">
                        <img src="https://via.placeholder.com/40" alt="Admin">
                        <span>Admin</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </header>

            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="card">
                    <div class="card-icon bg-blue">
                        <i class="fas fa-images"></i>
                    </div>
                    <div class="card-info">
                        <h3 id="totalImages">0</h3>
                        <p>Jami Rasmlar</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon bg-green">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="card-info">
                        <h3 id="totalVideos">0</h3>
                        <p>Jami Videolar</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon bg-orange">
                        <i class="fas fa-hdd"></i>
                    </div>
                    <div class="card-info">
                        <h3 id="totalSize">0 MB</h3>
                        <p>Ishlatilgan Xotira</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon bg-red">
                        <i class="fas fa-upload"></i>
                    </div>
                    <div class="card-info">
                        <h3 id="todayUploads">0</h3>
                        <p>Bugun Yuklangan</p>
                    </div>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="upload-section">
                <div class="section-header">
                    <h2>Media Yuklash</h2>
                    <p>Rasm yoki video fayllarni yuklang</p>
                </div>
                <form id="uploadForm" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Fayllarni shu yerga tortib tashlang yoki <span>bosing</span></p>
                        <input type="file" id="fileInput" name="media_files" multiple accept="image/*,video/*">
                    </div>
                </form>
                <div class="upload-progress" id="uploadProgress">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <span class="progress-text">0%</span>
                </div>
            </div>

            <!-- Media Gallery -->
            <div class="media-gallery">
                <div class="section-header">
                    <h2>Media Galereya</h2>
                    <div class="filter-options">
                        <button class="filter-btn active" data-filter="all">Hammasi</button>
                        <button class="filter-btn" data-filter="image">Rasmlar</button>
                        <button class="filter-btn" data-filter="video">Videolar</button>
                    </div>
                </div>

                <div class="media-grid" id="mediaGrid">
                    <!-- Media items will be dynamically added here -->
                </div>
            </div>

            <!-- Media Preview Modal -->
            <div class="modal" id="mediaModal">
                <div class="modal-content">
                    <span class="close-btn" id="closeModal">&times;</span>
                    <div class="modal-body">
                        <img id="modalImage" src="" alt="Preview">
                        <video id="modalVideo" controls>
                            <source src="" type="video/mp4">
                            Sizning brauzeringiz video formatini qo'llab-quvvatlamaydi.
                        </video>
                        <div class="media-info">
                            <h3 id="mediaTitle">Media Nomi</h3>
                            <p id="mediaSize">O'lcham: 0 MB</p>
                            <p id="mediaDate">Yuklangan: 2023-01-01</p>
                            <div class="action-buttons">
                                <button class="btn btn-primary" id="downloadBtn"><i class="fas fa-download"></i> Yuklab olish</button>
                                <button class="btn btn-danger" id="deleteBtn"><i class="fas fa-trash"></i> O'chirish</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // O'zgaruvchilar
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const uploadForm = document.getElementById('uploadForm');
            const uploadProgress = document.getElementById('uploadProgress');
            const progressFill = document.querySelector('.progress-fill');
            const progressText = document.querySelector('.progress-text');
            const mediaGrid = document.getElementById('mediaGrid');
            const mediaModal = document.getElementById('mediaModal');
            const closeModal = document.getElementById('closeModal');
            const modalImage = document.getElementById('modalImage');
            const modalVideo = document.getElementById('modalVideo');
            const mediaTitle = document.getElementById('mediaTitle');
            const mediaSize = document.getElementById('mediaSize');
            const mediaDate = document.getElementById('mediaDate');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const downloadBtn = document.getElementById('downloadBtn');
            const deleteBtn = document.getElementById('deleteBtn');

            // Statistik elementlar
            const totalImagesEl = document.getElementById('totalImages');
            const totalVideosEl = document.getElementById('totalVideos');
            const totalSizeEl = document.getElementById('totalSize');
            const todayUploadsEl = document.getElementById('todayUploads');

            // Joriy filter
            let currentFilter = 'all';
            let currentMedia = null;

            // Dastlabki media yuklash
            loadMediaItems();

            // Yuklash maydoni hodisalari
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#3498db';
                uploadArea.style.background = 'rgba(52, 152, 219, 0.1)';
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#bdc3c7';
                uploadArea.style.background = '';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#bdc3c7';
                uploadArea.style.background = '';

                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleUpload();
                }
            });

            // Fayl input hodisasi
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) {
                    handleUpload();
                }
            });

            // Fayllarni yuklash
            function handleUpload() {
                // Faqat rasm va video fayllarini qabul qilish
                const validFiles = Array.from(fileInput.files).filter(file => {
                    return file.type.startsWith('image/') || file.type.startsWith('video/');
                });

                if (validFiles.length === 0) {
                    showNotification('Iltimos, faqat rasm yoki video fayllarini yuklang!', 'error');
                    return;
                }

                // Yuklash jarayonini ko'rsatish
                uploadProgress.style.display = 'block';

                // FormData yaratish
                const formData = new FormData(uploadForm);

                // AJAX so'rov
                const xhr = new XMLHttpRequest();

                // Progress hodisasi
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressFill.style.width = `${percentComplete}%`;
                        progressText.textContent = `${Math.round(percentComplete)}%`;
                    }
                });

                // Yuklash tugaganda
                xhr.addEventListener('load', () => {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            showNotification(`${response.uploaded_count} ta fayl muvaffaqiyatli yuklandi!`);
                            loadMediaItems(); // Galereyani yangilash
                        } else {
                            showNotification('Yuklashda xatolik yuz berdi!', 'error');
                        }
                    } else {
                        showNotification('Server xatosi!', 'error');
                    }

                    // Progress bari va formani tozalash
                    setTimeout(() => {
                        uploadProgress.style.display = 'none';
                        progressFill.style.width = '0%';
                        progressText.textContent = '0%';
                        uploadForm.reset();
                    }, 1000);
                });

                // Xatolik hodisasi
                xhr.addEventListener('error', () => {
                    showNotification('Tarmoq xatosi!', 'error');
                    uploadProgress.style.display = 'none';
                    progressFill.style.width = '0%';
                    progressText.textContent = '0%';
                });

                // So'rovni yuborish
                xhr.open('POST', '{% url "upload_media" %}');
                xhr.send(formData);
            }

            // Media elementlarini yuklash
            function loadMediaItems() {
                // AJAX so'rov orqali media ma'lumotlarini olish
                fetch('{% url "get_media" %}')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            displayMediaItems(data.media);
                            updateStats(data.stats);
                        } else {
                            showNotification('Media yuklashda xatolik!', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Xatolik:', error);
                        showNotification('Server bilan aloqa xatosi!', 'error');
                    });
            }

            // Media elementlarini ekranga chiqarish
            function displayMediaItems(mediaItems) {
                mediaGrid.innerHTML = '';

                // Filtrlangan media
                const filteredMedia = currentFilter === 'all'
                    ? mediaItems
                    : mediaItems.filter(media => media.type === currentFilter);

                if (filteredMedia.length === 0) {
                    // Bo'sh holat
                    mediaGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-${currentFilter === 'image' ? 'images' : currentFilter === 'video' ? 'video' : 'folder-open'}"></i>
                            <h3>Hech qanday media topilmadi</h3>
                            <p>${currentFilter === 'all' ? 'Rasm yoki video yuklang' : `${currentFilter === 'image' ? 'Rasm' : 'Video'} yuklang`}</p>
                        </div>
                    `;
                    return;
                }

                // Media elementlarini yaratish
                filteredMedia.forEach(media => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-item fade-in';
                    mediaItem.setAttribute('data-id', media.id);
                    mediaItem.setAttribute('data-type', media.type);

                    mediaItem.innerHTML = `
                        ${media.type === 'image'
                            ? `<img src="${media.url}" alt="${media.name}">`
                            : `<video><source src="${media.url}" type="video/mp4"></video>`}
                        <div class="media-type">${media.type === 'image' ? 'RASM' : 'VIDEO'}</div>
                        <div class="media-overlay">
                            <div class="media-name">${media.name}</div>
                            <div class="media-size">${media.size}</div>
                        </div>
                    `;

                    mediaItem.addEventListener('click', () => openMediaModal(media));
                    mediaGrid.appendChild(mediaItem);
                });
            }

            // Statistikani yangilash
            function updateStats(stats) {
                totalImagesEl.textContent = stats.total_images;
                totalVideosEl.textContent = stats.total_videos;
                totalSizeEl.textContent = stats.total_size;
                todayUploadsEl.textContent = stats.today_uploads;
            }

            // Media modalini ochish
            function openMediaModal(media) {
                currentMedia = media;

                // Modal tarkibini to'ldirish
                mediaTitle.textContent = media.name;
                mediaSize.textContent = `O'lcham: ${media.size}`;
                mediaDate.textContent = `Yuklangan: ${media.date}`;

                // Media turiga qarab kontentni sozlash
                if (media.type === 'image') {
                    modalImage.src = media.url;
                    modalImage.style.display = 'block';
                    modalVideo.style.display = 'none';
                } else {
                    modalVideo.querySelector('source').src = media.url;
                    modalVideo.load();
                    modalVideo.style.display = 'block';
                    modalImage.style.display = 'none';
                }

                // Modalni ko'rsatish
                mediaModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            // Media modalini yopish
            closeModal.addEventListener('click', () => {
                mediaModal.style.display = 'none';
                document.body.style.overflow = 'auto';

                // Videoni to'xtatish
                if (!modalVideo.paused) {
                    modalVideo.pause();
                }
            });

            // Modal tashqarisini bosganda yopish
            mediaModal.addEventListener('click', (e) => {
                if (e.target === mediaModal) {
                    mediaModal.style.display = 'none';
                    document.body.style.overflow = 'auto';

                    // Videoni to'xtatish
                    if (!modalVideo.paused) {
                        modalVideo.pause();
                    }
                }
            });

            // Yuklab olish tugmasi
            downloadBtn.addEventListener('click', () => {
                if (currentMedia) {
                    const a = document.createElement('a');
                    a.href = currentMedia.url;
                    a.download = currentMedia.name;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                }
            });

            // O'chirish tugmasi
            deleteBtn.addEventListener('click', () => {
                if (currentMedia && confirm(`"${currentMedia.name}" ni o'chirishni istaysizmi?`)) {
                    // AJAX so'rov orqali media ni o'chirish
                    fetch(`{% url "delete_media" %}?id=${currentMedia.id}`, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('Media muvaffaqiyatli o\'chirildi');
                            mediaModal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                            loadMediaItems(); // Galereyani yangilash
                        } else {
                            showNotification('O\'chirishda xatolik!', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Xatolik:', error);
                        showNotification('Server bilan aloqa xatosi!', 'error');
                    });
                }
            });

            // Filter tugmalari
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Faol tugmani yangilash
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // Filterni yangilash
                    currentFilter = btn.getAttribute('data-filter');

                    // Media elementlarini yangilash
                    loadMediaItems();
                });
            });

            // Bildirishnoma ko'rsatish
            function showNotification(message, type = 'success') {
                // Eski bildirishnomani olib tashlash
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }

                // Yangi bildirishnoma yaratish
                const notification = document.createElement('div');
                notification.className = `notification ${type === 'error' ? 'error' : ''}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                    <span>${message}</span>
                `;

                document.body.appendChild(notification);

                // Ko'rsatish
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);

                // Yashirish
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }

            // Klaviatura tugmalari
            document.addEventListener('keydown', (e) => {
                // ESC tugmasi modalni yopish
                if (e.key === 'Escape' && mediaModal.style.display === 'flex') {
                    mediaModal.style.display = 'none';
                    document.body.style.overflow = 'auto';

                    // Videoni to'xtatish
                    if (!modalVideo.paused) {
                        modalVideo.pause();
                    }
                }
            });
        });
    </script>
</body>
</html>